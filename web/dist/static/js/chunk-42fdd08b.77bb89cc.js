(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-42fdd08b"],{"013f":function(t,e,r){var o=r("4ce5"),a=r("224c"),n=r("008a"),i=r("eafa"),l=r("5dd2");t.exports=function(t,e){var r=1==t,s=2==t,c=3==t,u=4==t,p=6==t,d=5==t||p,f=e||l;return function(e,l,m){for(var b,g,h=n(e),v=a(h),y=o(l,m,3),O=i(v.length),w=0,j=r?f(e,O):s?f(e,0):void 0;O>w;w++)if((d||w in v)&&(b=v[w],g=y(b,w,h),t))if(r)j[w]=g;else if(g)switch(t){case 3:return!0;case 5:return b;case 6:return w;case 2:j.push(b)}else if(u)return!1;return p?-1:c||u?u:j}}},"1ba6":function(t,e,r){"use strict";r.r(e);var o=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-row",{staticClass:"app-container"},[r("el-row",{staticClass:"app-bar",attrs:{type:"flex",justify:"end"}},[r("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.handleAdd}},[t._v("添加")])],1),t._v(" "),r("el-table",{staticStyle:{width:"100%"},attrs:{border:"",stripe:"","highlight-current-row":"",data:t.tableData}},[r("el-table-column",{attrs:{prop:"name",label:"服务器",width:"100"}}),t._v(" "),r("el-table-column",{attrs:{prop:"ip",label:"IP",width:"100"}}),t._v(" "),r("el-table-column",{attrs:{prop:"port",label:"端口"}}),t._v(" "),r("el-table-column",{attrs:{prop:"owner",label:"sshKey所有者",width:"100","show-overflow-tooltip":""}}),t._v(" "),r("el-table-column",{attrs:{prop:"group",label:"分组",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t.findGroupName(e.row.groupId))+"\n      ")]}}])}),t._v(" "),r("el-table-column",{attrs:{prop:"description",label:"描述","show-overflow-tooltip":""}}),t._v(" "),r("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"160"}}),t._v(" "),r("el-table-column",{attrs:{prop:"updateTime",label:"更新时间",width:"160"}}),t._v(" "),r("el-table-column",{attrs:{prop:"operation",label:"操作",width:"220",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(r){return t.handleEdit(e.row)}}},[t._v("编辑")]),t._v(" "),r("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(r){return t.handleInstall(e.row)}}},[t._v("安装")]),t._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(r){return t.handleRemove(e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),r("el-row",{staticStyle:{"margin-top":"10px"},attrs:{type:"flex",justify:"end"}},[r("el-pagination",{attrs:{"hide-on-single-page":"",total:t.pagination.total,"page-size":t.pagination.rows,background:"",layout:"prev, pager, next"},on:{"current-change":t.handlePageChange}})],1),t._v(" "),r("el-dialog",{attrs:{title:"服务器设置",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.formProps.loading,expression:"formProps.loading"}],ref:"form",attrs:{"element-loading-text":t.formProps.loadingMessage,rules:t.formRules,model:t.formData,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"服务器名称",prop:"name"}},[r("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"IP",prop:"ip"}},[r("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.ip,callback:function(e){t.$set(t.formData,"ip",e)},expression:"formData.ip"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"port",prop:"port"}},[r("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.port,callback:function(e){t.$set(t.formData,"port",t._n(e))},expression:"formData.port"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"sshKey所有者",prop:"owner"}},[r("el-input",{attrs:{autocomplete:"off",placeholder:"root"},model:{value:t.formData.owner,callback:function(e){t.$set(t.formData,"owner",e)},expression:"formData.owner"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"绑定分组",prop:"groupId"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择分组"},model:{value:t.formData.groupId,callback:function(e){t.$set(t.formData,"groupId",e)},expression:"formData.groupId"}},[t.hasGroupManagerPermission()?r("el-option",{attrs:{label:"默认",value:0}}):t._e(),t._v(" "),t._l(t.groupOption,(function(t,e){return r("el-option",{key:e,attrs:{label:t.name,value:t.id}})}))],2)],1),t._v(" "),r("el-form-item",{attrs:{label:"描述",prop:"description"}},[r("el-input",{attrs:{type:"textarea",autosize:{minRows:2},placeholder:"请输入描述"},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1)],1),t._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-row",{attrs:{type:"flex",justify:"space-between"}},[r("el-button",{attrs:{type:"success"},on:{click:t.check}},[t._v("测试连接")]),t._v(" "),r("el-row",[r("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),r("el-button",{attrs:{disabled:t.formProps.disabled,type:"primary"},on:{click:t.submit}},[t._v("确 定")])],1)],1)],1)],1),t._v(" "),r("el-dialog",{attrs:{title:"安装模板",visible:t.templateDialogVisible},on:{"update:visible":function(e){t.templateDialogVisible=e}}},[r("el-row",{staticClass:"template-dialog"},[r("el-form",{ref:"templateForm",attrs:{rules:t.templateFormRules,model:t.templateFormData,"label-width":"90px"}},[r("el-form-item",{attrs:{label:"选择模板",prop:"templateId"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择模板"},model:{value:t.templateFormData.templateId,callback:function(e){t.$set(t.templateFormData,"templateId",e)},expression:"templateFormData.templateId"}},t._l(t.templateOption,(function(t,e){return r("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1)],1)],1),t._v(" "),r("el-row",[r("el-collapse",{attrs:{accordion:""},on:{change:t.handleTokenChange}},t._l(t.installPreviewList.slice().reverse(),(function(e,o){return r("el-collapse-item",{key:o,attrs:{name:e.token}},[r("template",{slot:"title"},[r("span",{staticStyle:{"margin-right":"10px"}},[t._v("token: "+t._s(e.token))]),t._v(" "),1===e.installState?r("el-tag",{attrs:{type:"success",effect:"plain"}},[t._v("成功")]):r("el-tag",{attrs:{type:"danger",effect:"plain"}},[t._v("失败")])],1),t._v(" "),r("codemirror",{attrs:{value:t.installTrace,options:t.cmOptions}})],2)})),1)],1)],1),t._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(e){t.templateDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),r("el-button",{attrs:{disabled:t.templateFormProps.disabled,type:"primary"},on:{click:t.install}},[t._v("确 定")])],1)],1),t._v(" "),r("el-dialog",{attrs:{title:"安装进度",visible:t.installDialogVisible},on:{"update:visible":function(e){t.installDialogVisible=e}}},[r("codemirror",{attrs:{value:t.installLog,options:t.cmOptions}})],1)],1)},a=[],n=(r("f548"),r("e697"),r("cc57"),r("6d57"),r("aa22")),i=r("23ba"),l=r("c621"),s=r("ed08"),c=r("8a2b"),u=(r("148a"),r("4fc6"),r("d647"),r("85e5"),r("6990"),r("a219"),{components:{codemirror:c["codemirror"]},data:function(){return{dialogVisible:!1,templateDialogVisible:!1,installDialogVisible:!1,tableData:[],pagination:{page:1,rows:11,total:0},groupOption:[],templateOption:[],installToken:"",installPreviewList:[],installTraceList:[],installLog:"",tempFormData:{},cmOptions:{tabSize:4,mode:"text/x-sh",lineNumbers:!1,line:!1,scrollbarStyle:"overlay",theme:"darcula",readOnly:!0,autoRefresh:!0},formProps:{loading:!1,loadingMessage:"测试连接中，请稍后",disabled:!1},formData:{id:0,name:"",ip:"",port:22,owner:"",groupId:"",description:""},formRules:{name:[{required:!0,message:"请输入服务器名称",trigger:"blur"}],ip:[{required:!0,message:"请输入服务器ip",trigger:"blur"}],port:[{type:"number",required:!0,min:0,max:65535,message:"请输入正确服务器端口",trigger:"blur"}],owner:[{required:!0,message:"请输入SSH-KEY的所有者",trigger:"blur"}],groupId:[{required:!0,message:"请选择分组",trigger:"blur"}],description:[{max:255,message:"描述最多255个字符",trigger:"blur"}]},templateFormProps:{disabled:!1},templateFormData:{templateId:"",serverName:"",serverId:0},templateFormRules:{templateId:[{required:!0,message:"请选择模板",trigger:"change"}]}}},computed:{installTrace:function(){var t=this,e="";return this.installTraceList.forEach((function(r){1===r.type?(e+="[goploy~]$ "+r.command+"\n",e+=r.detail+"\n"):2===r.type?(e+="[goploy~]$ "+r.ssh+"\n",e+=r.detail+"\n"):3===r.type&&(e+="["+t.templateFormData.serverName+"~]$ "+r.script+"\n",e+=r.detail+"\n")})),e}},created:function(){this.storeFormData(),this.getList(),this.getGroupOption(),this.getTemplateOption()},methods:{getList:function(){var t=this;Object(n["f"])(this.pagination).then((function(e){var r=e.data.serverList||[];r.forEach((function(t){t.createTime=Object(s["c"])(t.createTime),t.updateTime=Object(s["c"])(t.updateTime)})),t.tableData=r,t.pagination=e.data.pagination}))},handlePageChange:function(t){this.pagination.page=t,this.getList()},getGroupOption:function(){var t=this;Object(i["e"])().then((function(e){t.groupOption=e.data.groupList||[]}))},getTemplateOption:function(){var t=this;Object(l["d"])().then((function(e){t.templateOption=e.data.templateList||[]}))},handleAdd:function(){this.restoreFormData(),this.dialogVisible=!0},handleEdit:function(t){this.formData=Object.assign({},t),this.dialogVisible=!0},handleRemove:function(t){var e=this;this.$confirm("此操作将删除该服务器, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(n["i"])(t.id).then((function(t){e.$message({message:"删除成功",type:"success",duration:5e3}),e.getList()}))})).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},handleInstall:function(t){var e=this;this.templateFormData.serverId=t.id,this.templateFormData.serverName=t.name,Object(n["e"])(t.id).then((function(t){e.installPreviewList=t.data.installTraceList||[]})),this.templateDialogVisible=!0},handleTokenChange:function(t){var e=this;""!==t&&Object(n["d"])(t).then((function(t){var r=t.data.installTraceList||[];e.installTraceList=r.map((function(t){return Object.assign(t,JSON.parse(t.ext)),t}))}))},check:function(){var t=this;this.$refs.form.validate((function(e){if(!e)return!1;t.formProps.loading=!0,t.formProps.disabled=!0,Object(n["b"])(t.formData).then((function(e){t.$message({message:"连接成功",type:"success",duration:5e3})})).finally((function(e){t.formProps.loading=!1,t.formProps.disabled=!1}))}))},submit:function(){var t=this;this.$refs.form.validate((function(e){if(!e)return!1;0===t.formData.id?t.add():t.edit()}))},add:function(){var t=this;this.formProps.disabled=!0,Object(n["a"])(this.formData).then((function(e){t.getList(),t.$message({message:"添加成功",type:"success",duration:5e3})})).finally((function(){t.formProps.disabled=t.dialogVisible=!1}))},edit:function(){var t=this;this.formProps.disabled=!0,Object(n["c"])(this.formData).then((function(e){t.getList(),t.$message({message:"编辑成功",type:"success",duration:5e3})})).finally((function(){t.formProps.disabled=t.dialogVisible=!1}))},install:function(){var t=this;this.$refs.templateForm.validate((function(e){if(!e)return!1;t.templateFormProps.disabled=!0,t.installDialogVisible=!0,t.templateFormProps.disabled=t.templateDialogVisible=!1,t.installLog="",t.connectWebSocket().then((function(e){Object(n["h"])(t.templateFormData.serverId,t.templateFormData.templateId).then((function(e){t.$message({message:e.message,duration:5e3})}))}))}))},connectWebSocket:function(){var t=this;return this.webSocket&&this.webSocket.readyState<2?(console.log("reusing the socket connection [state = "+this.webSocket.readyState+"]: "+this.webSocket.url),Promise.resolve(this.webSocket)):new Promise((function(e,r){t.webSocket=new WebSocket("ws://"+window.location.host+"/ws/unicast"),t.webSocket.onopen=function(){console.log("socket connection is opened [state = "+t.webSocket.readyState+"]: "+t.webSocket.url),e(t.webSocket)},t.webSocket.onerror=function(t){console.error("socket connection error : ",t),r(t)},t.webSocket.onclose=function(e){t.webSocket=null,console.log("connection closed ("+e.code+")")},t.webSocket.onmessage=function(e){var r=JSON.parse(e.data);Object.assign(r,JSON.parse(r.ext));var o="";1===r.type?(o+="[goploy~]$ "+r.command+"\n",o+=r.detail+"\n"):2===r.type?(o+="[goploy~]$ "+r.ssh+"\n",o+=r.detail+"\n"):3===r.type&&(o+="["+t.templateFormData.serverName+"~]$ "+r.script+"\n",o+=r.detail+"\n"),t.installLog+=o}}))},findGroupName:function(t){var e=this.groupOption.find((function(e){return e.id===t}));return e?e["name"]:"默认"},formatDetail:function(t){return t?t.replace(/\n|(\r\n)/g,"<br>"):""},storeFormData:function(){this.tempFormData=JSON.parse(JSON.stringify(this.formData))},restoreFormData:function(){this.formData=JSON.parse(JSON.stringify(this.tempFormData))}}}),p=u,d=(r("345b"),r("4023")),f=Object(d["a"])(p,o,a,!1,null,"65e1ae38",null);e["default"]=f.exports},2346:function(t,e,r){var o=r("75c4");t.exports=Array.isArray||function(t){return"Array"==o(t)}},"23ba":function(t,e,r){"use strict";r.d(e,"d",(function(){return l})),r.d(e,"e",(function(){return s})),r.d(e,"c",(function(){return c})),r.d(e,"a",(function(){return u})),r.d(e,"b",(function(){return p})),r.d(e,"f",(function(){return d}));r("5ab2"),r("6d57"),r("e10e");var o=r("88d6"),a=r("b775");function n(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach((function(e){Object(o["a"])(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function l(t){return Object(a["a"])({url:"/group/getList",method:"get",params:i({},t)})}function s(){return Object(a["a"])({url:"/group/getOption",method:"get"})}function c(){return Object(a["a"])({url:"/group/getDeployOption",method:"get"})}function u(t){return Object(a["a"])({url:"/group/add",method:"post",data:t})}function p(t){return Object(a["a"])({url:"/group/edit",method:"post",data:t})}function d(t){return Object(a["a"])({url:"/group/remove",method:"delete",data:{id:t}})}},"345b":function(t,e,r){"use strict";var o=r("a5e8"),a=r.n(o);a.a},"5dd2":function(t,e,r){var o=r("81dc");t.exports=function(t,e){return new(o(t))(e)}},"81dc":function(t,e,r){var o=r("fb68"),a=r("2346"),n=r("cb3d")("species");t.exports=function(t){var e;return a(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!a(e.prototype)||(e=void 0),o(e)&&(e=e[n],null===e&&(e=void 0))),void 0===e?Array:e}},a219:function(t,e,r){(function(t){t(r("a564"))})((function(t){"use strict";function e(e,o){function a(){e.display.wrapper.offsetHeight?(r(e,o),e.display.lastWrapHeight!=e.display.wrapper.clientHeight&&e.refresh()):o.timeout=setTimeout(a,o.delay)}o.timeout=setTimeout(a,o.delay),o.hurry=function(){clearTimeout(o.timeout),o.timeout=setTimeout(a,50)},t.on(window,"mouseup",o.hurry),t.on(window,"keyup",o.hurry)}function r(e,r){clearTimeout(r.timeout),t.off(window,"mouseup",r.hurry),t.off(window,"keyup",r.hurry)}t.defineOption("autoRefresh",!1,(function(t,o){t.state.autoRefresh&&(r(t,t.state.autoRefresh),t.state.autoRefresh=null),o&&0==t.display.wrapper.offsetHeight&&e(t,t.state.autoRefresh={delay:o.delay||250})}))}))},a5e8:function(t,e,r){},aa22:function(t,e,r){"use strict";r.d(e,"f",(function(){return l})),r.d(e,"e",(function(){return s})),r.d(e,"d",(function(){return c})),r.d(e,"g",(function(){return u})),r.d(e,"a",(function(){return p})),r.d(e,"c",(function(){return d})),r.d(e,"b",(function(){return f})),r.d(e,"i",(function(){return m})),r.d(e,"h",(function(){return b}));r("5ab2"),r("6d57"),r("e10e");var o=r("88d6"),a=r("b775");function n(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach((function(e){Object(o["a"])(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function l(t){return Object(a["a"])({url:"/server/getList",method:"get",params:i({},t)})}function s(t){return Object(a["a"])({url:"/server/getInstallPreview",method:"get",params:{serverId:t}})}function c(t){return Object(a["a"])({url:"/server/getInstallList",method:"get",params:{token:t}})}function u(){return Object(a["a"])({url:"/server/getOption",method:"get"})}function p(t){return Object(a["a"])({url:"/server/add",method:"post",data:t})}function d(t){return Object(a["a"])({url:"/server/edit",method:"post",data:t})}function f(t){return Object(a["a"])({timeout:1e5,url:"/server/check",method:"post",data:t})}function m(t){return Object(a["a"])({url:"/server/remove",method:"delete",data:{id:t}})}function b(t,e){return Object(a["a"])({url:"/server/install",method:"post",data:{serverId:t,templateId:e}})}},c621:function(t,e,r){"use strict";r.d(e,"c",(function(){return l})),r.d(e,"d",(function(){return s})),r.d(e,"a",(function(){return c})),r.d(e,"b",(function(){return u})),r.d(e,"e",(function(){return p})),r.d(e,"f",(function(){return d}));r("5ab2"),r("6d57"),r("e10e");var o=r("88d6"),a=r("b775");function n(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach((function(e){Object(o["a"])(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function l(t){return Object(a["a"])({url:"/template/getList",method:"get",params:i({},t)})}function s(){return Object(a["a"])({url:"/template/getOption",method:"get"})}function c(t){return Object(a["a"])({url:"/template/add",method:"post",data:t})}function u(t){return Object(a["a"])({url:"/template/edit",method:"post",data:t})}function p(t){return Object(a["a"])({url:"/template/remove",method:"delete",data:{id:t}})}function d(t,e){return Object(a["a"])({url:"/template/removePackage",method:"delete",data:{templateId:t,filename:e}})}},e697:function(t,e,r){"use strict";var o=r("e46b"),a=r("013f")(5),n="find",i=!0;n in[]&&Array(1)[n]((function(){i=!1})),o(o.P+o.F*i,"Array",{find:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),r("0e8b")(n)}}]);