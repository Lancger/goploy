(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-38f7d64e"],{"23ba":function(t,e,r){"use strict";r.d(e,"d",(function(){return o})),r.d(e,"f",(function(){return n})),r.d(e,"e",(function(){return i})),r.d(e,"c",(function(){return l})),r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return c})),r.d(e,"g",(function(){return d}));var a=r("b775");function o(t){var e=t.page,r=t.rows;return Object(a["a"])({url:"/group/getList",method:"get",params:{page:e,rows:r}})}function n(){return Object(a["a"])({url:"/group/getTotal",method:"get",params:{}})}function i(){return Object(a["a"])({url:"/group/getOption",method:"get"})}function l(){return Object(a["a"])({url:"/group/getDeployOption",method:"get"})}function s(t){return Object(a["a"])({url:"/group/add",method:"post",data:t})}function c(t){return Object(a["a"])({url:"/group/edit",method:"post",data:t})}function d(t){return Object(a["a"])({url:"/group/remove",method:"delete",data:{id:t}})}},"24d2":function(t,e,r){"use strict";r.d(e,"j",(function(){return o})),r.d(e,"n",(function(){return n})),r.d(e,"l",(function(){return i})),r.d(e,"k",(function(){return l})),r.d(e,"h",(function(){return s})),r.d(e,"i",(function(){return c})),r.d(e,"g",(function(){return d})),r.d(e,"a",(function(){return u})),r.d(e,"e",(function(){return p})),r.d(e,"o",(function(){return f})),r.d(e,"b",(function(){return m})),r.d(e,"d",(function(){return b})),r.d(e,"q",(function(){return h})),r.d(e,"p",(function(){return v})),r.d(e,"c",(function(){return g})),r.d(e,"f",(function(){return y})),r.d(e,"r",(function(){return _})),r.d(e,"m",(function(){return D}));var a=r("b775");function o(t,e){var r=t.page,o=t.rows;return Object(a["a"])({url:"/project/getList",method:"get",params:{page:r,rows:o,projectName:e}})}function n(t){return Object(a["a"])({url:"/project/getTotal",method:"get",params:{projectName:t}})}function i(t){return Object(a["a"])({url:"/project/getRemoteBranchList",method:"get",timeout:0,params:{url:t}})}function l(){return Object(a["a"])({url:"/project/getOption",method:"get",params:{}})}function s(t){return Object(a["a"])({url:"/project/getBindServerList",method:"get",params:{id:t}})}function c(t){return Object(a["a"])({url:"/project/getBindUserList",method:"get",params:{id:t}})}function d(t){return Object(a["a"])({url:"/project/getBindProjectList",method:"get",params:{userId:t}})}function u(t){return Object(a["a"])({url:"/project/add",method:"post",data:t})}function p(t){return Object(a["a"])({url:"/project/edit",method:"post",data:t})}function f(t){return Object(a["a"])({url:"/project/remove",method:"delete",data:{id:t}})}function m(t){return Object(a["a"])({url:"/project/addServer",method:"post",data:t})}function b(t){return Object(a["a"])({url:"/project/addUser",method:"post",data:t})}function h(t){return Object(a["a"])({url:"/project/removeProjectUser",method:"delete",data:{projectUserId:t}})}function v(t){return Object(a["a"])({url:"/project/removeProjectServer",method:"delete",data:{projectServerId:t}})}function g(t){return Object(a["a"])({url:"/project/addTask",method:"post",data:t})}function y(t){return Object(a["a"])({url:"/project/editTask",method:"post",data:t})}function _(t){return Object(a["a"])({url:"/project/removeTask",method:"post",data:{id:t}})}function D(t,e){var r=t.page,o=t.rows;return Object(a["a"])({url:"/project/getTaskList",method:"get",params:{page:r,rows:o,id:e}})}},"8a92":function(t,e,r){},"9cea":function(t,e,r){"use strict";e["a"]={data:function(){return{tableHeight:window.innerHeight-160}},mounted:function(){try{var t=document.getElementsByClassName("app-bar")[0].clientHeight+140,e=window.innerHeight-t;this.tableHeight=e}catch(r){console.log("缺少节点app-bar")}}}},aa22:function(t,e,r){"use strict";r.d(e,"f",(function(){return o})),r.d(e,"h",(function(){return n})),r.d(e,"e",(function(){return i})),r.d(e,"d",(function(){return l})),r.d(e,"g",(function(){return s})),r.d(e,"a",(function(){return c})),r.d(e,"c",(function(){return d})),r.d(e,"b",(function(){return u})),r.d(e,"j",(function(){return p})),r.d(e,"i",(function(){return f}));var a=r("b775");function o(t){var e=t.page,r=t.rows;return Object(a["a"])({url:"/server/getList",method:"get",params:{page:e,rows:r}})}function n(){return Object(a["a"])({url:"/server/getTotal",method:"get",params:{}})}function i(t){return Object(a["a"])({url:"/server/getInstallPreview",method:"get",params:{serverId:t}})}function l(t){return Object(a["a"])({url:"/server/getInstallList",method:"get",params:{token:t}})}function s(){return Object(a["a"])({url:"/server/getOption",method:"get"})}function c(t){return Object(a["a"])({url:"/server/add",method:"post",data:t})}function d(t){return Object(a["a"])({url:"/server/edit",method:"post",data:t})}function u(t){return Object(a["a"])({timeout:1e5,url:"/server/check",method:"post",data:t})}function p(t){return Object(a["a"])({url:"/server/remove",method:"delete",data:{id:t}})}function f(t,e){return Object(a["a"])({url:"/server/install",method:"post",data:{serverId:t,templateId:e}})}},b996:function(t,e,r){"use strict";var a=r("e828"),o=r.n(a);o.a},c0f9:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-row",{staticClass:"app-container"},[r("el-row",{staticClass:"app-bar",attrs:{type:"flex",justify:"space-between"}},[r("el-row",[r("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入项目名称"},model:{value:t.projectName,callback:function(e){t.projectName=e},expression:"projectName"}}),t._v(" "),r("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.searchProjectList}},[t._v("搜索")])],1),t._v(" "),r("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.handleAdd}},[t._v("添加")])],1),t._v(" "),r("el-table",{key:t.tableHeight,staticStyle:{width:"100%"},attrs:{border:"",stripe:"","highlight-current-row":"","max-height":t.tableHeight,data:t.tableData}},[r("el-table-column",{attrs:{prop:"name",label:"项目名称",width:"200"}}),t._v(" "),r("el-table-column",{attrs:{prop:"url",label:"项目地址",width:"350"}}),t._v(" "),r("el-table-column",{attrs:{prop:"path",label:"部署路径","min-width":"200"}}),t._v(" "),r("el-table-column",{attrs:{prop:"group",label:"分组",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t.findGroupName(e.row.groupId))+"\n      ")]}}])}),t._v(" "),r("el-table-column",{attrs:{prop:"environment",width:"120",label:"环境"}}),t._v(" "),r("el-table-column",{attrs:{prop:"branch",width:"160",label:"分支"}}),t._v(" "),r("el-table-column",{attrs:{width:"80",label:"自动部署"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.autoDeploy?r("span",[t._v("关闭")]):r("span",[t._v("Webhook")])]}}])}),t._v(" "),r("el-table-column",{attrs:{prop:"operation",label:"操作",width:"350",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{type:"primary"},on:{click:function(r){return t.handleEdit(e.row)}}},[t._v("编辑")]),t._v(" "),r("el-button",{attrs:{type:"success"},on:{click:function(r){return t.handleServer(e.row)}}},[t._v("服务器管理")]),t._v(" "),r("el-button",{attrs:{type:"warning"},on:{click:function(r){return t.handleUser(e.row)}}},[t._v("成员管理")]),t._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:function(r){return t.handleRemove(e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),r("el-row",{staticStyle:{"margin-top":"10px"},attrs:{type:"flex",justify:"end"}},[r("el-pagination",{attrs:{"hide-on-single-page":"",total:t.pagination.total,"page-size":t.pagination.rows,background:"",layout:"prev, pager, next"},on:{"current-change":t.handlePageChange}})],1),t._v(" "),r("el-dialog",{staticClass:"project-setting-dialog",attrs:{title:"项目设置",visible:t.dialogVisible,width:"60%","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("el-form",{ref:"form",attrs:{rules:t.formRules,model:t.formData,"label-width":"90px"}},[r("el-tabs",{on:{"tab-click":t.handleTabClick},model:{value:t.formProps.tab,callback:function(e){t.$set(t.formProps,"tab",e)},expression:"formProps.tab"}},[r("el-tab-pane",{attrs:{label:"基本配置",name:"base"}},[r("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[r("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name","string"===typeof e?e.trim():e)},expression:"formData.name"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"项目地址",prop:"url"}},[r("el-row",{attrs:{type:"flex"}},[r("el-input",{attrs:{autocomplete:"off"},on:{change:function(e){t.formProps.branch=[]}},model:{value:t.formData.url,callback:function(e){t.$set(t.formData,"url","string"===typeof e?e.trim():e)},expression:"formData.url"}}),t._v(" "),r("el-button",{attrs:{icon:t.formProps.lsBranchLoading?"el-icon-loading":"el-icon-view",type:"success",disabled:t.formProps.lsBranchLoading},on:{click:t.getRemoteBranchList}},[t._v("测试连接")])],1)],1),t._v(" "),r("el-form-item",{attrs:{label:"部署路径",prop:"path"}},[r("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.path,callback:function(e){t.$set(t.formData,"path","string"===typeof e?e.trim():e)},expression:"formData.path"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"环境",prop:"environment"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择环境"},model:{value:t.formData.environment,callback:function(e){t.$set(t.formData,"environment",e)},expression:"formData.environment"}},[r("el-option",{attrs:{label:"生产环境",value:"生产环境"}}),t._v(" "),r("el-option",{attrs:{label:"预发布环境",value:"预发布环境"}}),t._v(" "),r("el-option",{attrs:{label:"测试环境",value:"测试环境"}}),t._v(" "),r("el-option",{attrs:{label:"开发环境",value:"开发环境"}})],1)],1),t._v(" "),r("el-form-item",{attrs:{label:"分支",prop:"branch"}},[r("el-row",{attrs:{type:"flex"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或填入"},model:{value:t.formData.branch,callback:function(e){t.$set(t.formData,"branch",e)},expression:"formData.branch"}},t._l(t.formProps.branch,(function(t){return r("el-option",{key:t,attrs:{label:t,value:t}})})),1),t._v(" "),r("el-button",{attrs:{icon:t.formProps.lsBranchLoading?"el-icon-loading":"el-icon-search",type:"success",disabled:t.formProps.lsBranchLoading},on:{click:t.getRemoteBranchList}},[t._v("列出分支")])],1)],1),t._v(" "),r("el-form-item",{attrs:{label:"rsync选项",prop:"rsyncOption"}},[r("el-input",{attrs:{type:"textarea",rows:2,autocomplete:"off",placeholder:"-rtv --exclude .git --delete-after"},model:{value:t.formData.rsyncOption,callback:function(e){t.$set(t.formData,"rsyncOption","string"===typeof e?e.trim():e)},expression:"formData.rsyncOption"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"绑定分组",prop:"groupId"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择分组"},model:{value:t.formData.groupId,callback:function(e){t.$set(t.formData,"groupId",e)},expression:"formData.groupId"}},[t.hasGroupManagerPermission()?r("el-option",{attrs:{label:"默认",value:0}}):t._e(),t._v(" "),t._l(t.groupOption,(function(t,e){return r("el-option",{key:e,attrs:{label:t.name,value:t.id}})}))],2)],1),t._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.formProps.showServers,expression:"formProps.showServers"}],attrs:{label:"绑定服务器",prop:"serverIds"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"选择服务器，可多选"},model:{value:t.formData.serverIds,callback:function(e){t.$set(t.formData,"serverIds",e)},expression:"formData.serverIds"}},t._l(t.serverOption,(function(t,e){return r("el-option",{key:e,attrs:{label:t.label,value:t.id}})})),1)],1),t._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.formProps.showUsers,expression:"formProps.showUsers"}],attrs:{label:"绑定用户",prop:"userIds"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"选择用户，可多选"},model:{value:t.formData.userIds,callback:function(e){t.$set(t.formData,"userIds",e)},expression:"formData.userIds"}},t._l(t.userOption,(function(t,e){return r("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1)],1)],1),t._v(" "),r("el-tab-pane",{attrs:{label:"软链部署(推荐)",name:"symlink"}},[r("el-row",{staticStyle:{margin:"0 10px"}},[r("p",[t._v("项目先同步到指定目录(rsync 软链目录)，然后ln -s 部署路径 软链目录")]),t._v(" "),r("p",[t._v("可以避免项目在同步传输文件的过程中，外部访问到部分正在同步的文件")]),t._v(" "),r("p",[t._v("备份最近10次的部署文件，以便快速回滚")])]),t._v(" "),r("el-form-item",{attrs:{label:"","label-width":"10px"}},[r("el-radio-group",{model:{value:t.formProps.symlink,callback:function(e){t.$set(t.formProps,"symlink",e)},expression:"formProps.symlink"}},[r("el-radio",{attrs:{label:!1}},[t._v("关闭")]),t._v(" "),r("el-radio",{attrs:{label:!0}},[t._v("开启")])],1)],1),t._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.formProps.symlink,expression:"formProps.symlink"}],attrs:{label:"目录",prop:"symlink_path","label-width":"50px"}},[r("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.symlinkPath,callback:function(e){t.$set(t.formData,"symlinkPath","string"===typeof e?e.trim():e)},expression:"formData.symlinkPath"}})],1),t._v(" "),r("el-row",{directives:[{name:"show",rawName:"v-show",value:t.formProps.symlink,expression:"formProps.symlink"}],staticStyle:{margin:"0 10px"}},[r("p",[t._v("如果部署路径已存在在目标服务器，请手动删除该目录"),r("span",{staticStyle:{color:"red"}},[t._v("rm -rf 部署路径")]),t._v("，否则软链将会不成功")]),t._v(" "),r("p",[t._v("如须更换目录，务必手动迁移原先的目录到目标服务器")])])],1),t._v(" "),r("el-tab-pane",{attrs:{name:"afterPullScript"}},[r("span",{attrs:{slot:"label"},slot:"label"},[t._v("\n            拉取后运行脚本\n            "),r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"bottom"}},[r("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n                拉取代码后在宿主服务器运行的脚本"),r("br"),t._v("\n                运行方式：打包成一份脚本文件"),r("br"),t._v("\n                检查服务器是否安装该脚本类型(默认以bash运行)"),r("br")]),t._v(" "),r("i",{staticClass:"el-icon-question",staticStyle:{"padding-left":"3px"}})])],1),t._v(" "),r("el-form-item",{attrs:{prop:"afterPullScript","label-width":"0px"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"脚本类型(默认bash)"},on:{change:t.handleScriptModeChange},model:{value:t.formData.afterPullScriptMode,callback:function(e){t.$set(t.formData,"afterPullScriptMode",e)},expression:"formData.afterPullScriptMode"}},t._l(t.scriptModeOption,(function(t,e){return r("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),r("el-form-item",{attrs:{prop:"afterPullScript","label-width":"0px"}},[r("codemirror",{ref:"afterPullScript",attrs:{options:t.cmOption,placeholder:"已切换至项目目录..."},model:{value:t.formData.afterPullScript,callback:function(e){t.$set(t.formData,"afterPullScript",e)},expression:"formData.afterPullScript"}})],1)],1),t._v(" "),r("el-tab-pane",{attrs:{name:"afterDeployScript"}},[r("span",{attrs:{slot:"label"},slot:"label"},[t._v("\n            部署后运行脚本\n            "),r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"bottom"}},[r("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n                部署后在目标服务器运行的脚本"),r("br"),t._v("\n                运行方式：打包成一份脚本文件"),r("br"),t._v("\n                如需重启服务，请注意是否需要nohup"),r("br"),t._v("\n                检查服务器是否安装该脚本类型(默认以bash运行)\n              ")]),t._v(" "),r("i",{staticClass:"el-icon-question",staticStyle:{"padding-left":"3px"}})])],1),t._v(" "),r("el-form-item",{attrs:{prop:"afterDeployScript","label-width":"0px"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"脚本类型(默认bash)"},on:{change:t.handleScriptModeChange},model:{value:t.formData.afterDeployScriptMode,callback:function(e){t.$set(t.formData,"afterDeployScriptMode",e)},expression:"formData.afterDeployScriptMode"}},t._l(t.scriptModeOption,(function(t,e){return r("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),r("el-form-item",{attrs:{prop:"afterDeployScript","label-width":"0px"}},[r("codemirror",{ref:"afterDeployScript",attrs:{options:t.cmOption},model:{value:t.formData.afterDeployScript,callback:function(e){t.$set(t.formData,"afterDeployScript",e)},expression:"formData.afterDeployScript"}})],1)],1),t._v(" "),r("el-tab-pane",{attrs:{label:"构建触发器",name:"autoDeploy"}},[r("el-row",{staticStyle:{margin:"10px"}},[t._v("构建触发器：达成某种条件后自动构建发布项目")]),t._v(" "),r("el-radio-group",{staticStyle:{margin:"10px"},model:{value:t.formData.autoDeploy,callback:function(e){t.$set(t.formData,"autoDeploy",e)},expression:"formData.autoDeploy"}},[r("el-radio",{attrs:{label:0}},[t._v("关闭")]),t._v(" "),r("el-radio",{attrs:{label:1}},[t._v("webhook")])],1),t._v(" "),r("el-row",{directives:[{name:"show",rawName:"v-show",value:1===t.formData.autoDeploy,expression:"formData.autoDeploy===1"}],staticStyle:{margin:"10px"}},[t._v("\n            前往GitLab、GitHub或Gitee的webhook（可前往谷歌查找各自webhook所在的位置）"),r("br"),t._v("\n            填入连接"),r("span",{staticStyle:{color:"red"}},[t._v("http(s)://域名(IP)/deploy/webhook?project_name="+t._s(t.formData.name?t.formData.name:"请先填写项目名称"))]),r("br"),t._v("\n            勾选push event即可\n          ")])],1),t._v(" "),r("el-tab-pane",{attrs:{label:"高级配置",name:"advance"}},[r("el-form-item",{attrs:{label:"构建通知",prop:"notifyTarget"}},[r("el-row",{attrs:{type:"flex"}},[r("el-select",{attrs:{clearable:""},model:{value:t.formData.notifyType,callback:function(e){t.$set(t.formData,"notifyType",e)},expression:"formData.notifyType"}},[r("el-option",{attrs:{label:"无",value:0}}),t._v(" "),r("el-option",{attrs:{label:"企业微信",value:1}}),t._v(" "),r("el-option",{attrs:{label:"钉钉",value:2}})],1),t._v(" "),r("el-input",{attrs:{autocomplete:"off",placeholder:"webhook链接"},model:{value:t.formData.notifyTarget,callback:function(e){t.$set(t.formData,"notifyTarget","string"===typeof e?e.trim():e)},expression:"formData.notifyTarget"}})],1)],1)],1)],1)],1),t._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),r("el-button",{attrs:{disabled:t.formProps.disabled,type:"primary"},on:{click:t.submit}},[t._v("确 定")])],1)],1),t._v(" "),r("el-dialog",{attrs:{title:"服务器管理",visible:t.dialogServerVisible},on:{"update:visible":function(e){t.dialogServerVisible=e}}},[r("el-row",{staticClass:"app-bar",attrs:{type:"flex",justify:"end"}},[r("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.handleAddServer}},[t._v("添加")])],1),t._v(" "),r("el-table",{staticStyle:{width:"100%"},attrs:{border:"",stripe:"","highlight-current-row":"",data:t.tableServerData}},[r("el-table-column",{attrs:{prop:"serverId",label:"服务器ID",width:"100"}}),t._v(" "),r("el-table-column",{attrs:{prop:"serverName",label:"服务器名称",width:"100"}}),t._v(" "),r("el-table-column",{attrs:{prop:"serverDescription",label:"服务器描述","min-width":"200","show-overflow-tooltip":""}}),t._v(" "),r("el-table-column",{attrs:{prop:"insertTime",width:"160",label:"绑定时间"}}),t._v(" "),r("el-table-column",{attrs:{prop:"updateTime",width:"160",label:"更新时间"}}),t._v(" "),r("el-table-column",{attrs:{prop:"operation",label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{type:"danger"},on:{click:function(r){return t.removeProjectServer(e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(e){t.dialogServerVisible=!1}}},[t._v("取 消")])],1)],1),t._v(" "),r("el-dialog",{attrs:{title:"成员管理",visible:t.dialogUserVisible},on:{"update:visible":function(e){t.dialogUserVisible=e}}},[r("el-row",{staticClass:"app-bar",attrs:{type:"flex",justify:"end"}},[r("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.handleAddUser}},[t._v("添加")])],1),t._v(" "),r("el-table",{staticStyle:{width:"100%"},attrs:{border:"",stripe:"","highlight-current-row":"",data:t.tableUserData}},[r("el-table-column",{attrs:{prop:"userId",label:"用户ID"}}),t._v(" "),r("el-table-column",{attrs:{prop:"userName",label:"用户名称"}}),t._v(" "),r("el-table-column",{attrs:{prop:"insertTime",width:"160",label:"绑定时间"}}),t._v(" "),r("el-table-column",{attrs:{prop:"updateTime",width:"160",label:"更新时间"}}),t._v(" "),r("el-table-column",{attrs:{prop:"operation",label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{type:"danger"},on:{click:function(r){return t.removeProjectUser(e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(e){t.dialogUserVisible=!1}}},[t._v("取 消")])],1)],1),t._v(" "),r("el-dialog",{attrs:{title:"添加服务器",visible:t.dialogAddServerVisible},on:{"update:visible":function(e){t.dialogAddServerVisible=e}}},[r("el-form",{ref:"addServerForm",attrs:{rules:t.addServerFormRules,model:t.addServerFormData}},[r("el-form-item",{attrs:{label:"绑定服务器","label-width":"120px",prop:"serverIds"}},[r("el-select",{attrs:{multiple:"",placeholder:"选择服务器，可多选"},model:{value:t.addServerFormData.serverIds,callback:function(e){t.$set(t.addServerFormData,"serverIds",e)},expression:"addServerFormData.serverIds"}},t._l(t.serverOption,(function(t,e){return r("el-option",{key:e,attrs:{label:t.label,value:t.id}})})),1)],1)],1),t._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(e){t.dialogAddServerVisible=!1}}},[t._v("取 消")]),t._v(" "),r("el-button",{attrs:{disabled:t.addServerFormProps.disabled,type:"primary"},on:{click:t.addServer}},[t._v("确 定")])],1)],1),t._v(" "),r("el-dialog",{attrs:{title:"添加用户",visible:t.dialogAddUserVisible},on:{"update:visible":function(e){t.dialogAddUserVisible=e}}},[r("el-form",{ref:"addUserForm",attrs:{rules:t.addUserFormRules,model:t.addUserFormData}},[r("el-form-item",{attrs:{label:"绑定用户","label-width":"120px",prop:"userIds"}},[r("el-select",{attrs:{multiple:"",placeholder:"选择用户，可多选"},model:{value:t.addUserFormData.userIds,callback:function(e){t.$set(t.addUserFormData,"userIds",e)},expression:"addUserFormData.userIds"}},t._l(t.userOption,(function(t,e){return r("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1)],1)],1),t._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(e){t.dialogAddUserVisible=!1}}},[t._v("取 消")]),t._v(" "),r("el-button",{attrs:{disabled:t.addUserFormProps.disabled,type:"primary"},on:{click:t.addUser}},[t._v("确 定")])],1)],1)],1)},o=[],n=(r("e697"),r("cc57"),r("9cea")),i=r("c24f"),l=r("aa22"),s=r("23ba"),c=r("24d2"),d=r("8a2b"),u=(r("2750"),r("8b25"),r("2ae2"),r("ca46"),r("81ea"),r("b382"),r("7c4f"),r("37e3"),{components:{codemirror:d["codemirror"]},mixins:[n["a"]],data:function(){var t=this,e=function(e,r,a){0!==r&&""!==t.formData.notifyType||0===r&&""===t.formData.notifyType?a():a(new Error("请选择推送类型"))};return{scriptModeOption:[{label:"sh",value:"sh",mode:"text/x-sh"},{label:"zsh",value:"zsh",mode:"text/x-sh"},{label:"bash",value:"bash",mode:"text/x-sh"},{label:"python",value:"python",mode:"text/x-python"},{label:"php",value:"php",mode:"text/x-php"}],cmOption:{tabSize:4,mode:"text/x-sh",lineNumbers:!0,line:!0,scrollbarStyle:"overlay",theme:"darcula"},projectName:"",dialogVisible:!1,dialogServerVisible:!1,dialogUserVisible:!1,dialogAddServerVisible:!1,dialogAddUserVisible:!1,serverOption:[],userOption:[],groupOption:[],tableData:[],pagination:{page:1,rows:17,total:0},tableServerData:[],tableUserData:[],formProps:{symlink:!1,disabled:!1,branch:[],lsBranchLoading:!1,showServers:!0,showUsers:!0,tab:"base"},tempFormData:{},formData:{id:0,groupId:"",name:"",url:"",path:"",symlinkPath:"",afterPullScriptMode:"",afterPullScript:"",afterDeployScriptMode:"",afterDeployScript:"",environment:"生产环境",branch:"master",rsyncOption:"-rtv --exclude .git --delete-after",serverIds:[],userIds:[],autoDeploy:0,notifyType:0,notifyTarget:""},formRules:{name:[{required:!0,message:"请输入项目名称",trigger:["blur"]}],url:[{required:!0,message:"请输入项目地址",trigger:["blur"]}],path:[{required:!0,message:"请输入部署路径",trigger:["blur"]}],environment:[{required:!0,message:"请选择环境",trigger:["blur"]}],branch:[{required:!0,message:"请输入分支名称",trigger:["blur"]}],groupId:[{required:!0,message:"请选择分组",trigger:"blur"}],serverIds:[{type:"array",message:"请选择服务器",trigger:"change"}],userIds:[{type:"array",message:"请选择组员",trigger:"change"}],notifyTarget:[{validator:e,trigger:"blur"}]},addServerFormProps:{disabled:!1},addServerFormData:{projectId:0,serverIds:[]},addServerFormRules:{serverIds:[{type:"array",required:!0,message:"请选择服务器",trigger:"change"}]},addUserFormProps:{disabled:!1},addUserFormData:{projectId:0,userIds:[]},addUserFormRules:{userIds:[{type:"array",required:!0,message:"请选择用户",trigger:"change"}]}}},created:function(){this.storeFormData(),this.getOptions(),this.getList(),this.getTotal()},methods:{handleAdd:function(){this.restoreFormData(),this.formProps.showServers=this.formProps.showUsers=!0,this.formProps.symlink=!1,this.dialogVisible=!0},handleEdit:function(t){this.formData=Object.assign({},t),this.formData.serverIds=[],this.formData.userIds=[],this.formProps.symlink=""!==this.formData.symlinkPath,this.formProps.showServers=this.formProps.showUsers=!1,this.formProps.branch=[],this.dialogVisible=!0},handleRemove:function(t){var e=this;this.$confirm("此操作将删除该项目, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(c["o"])(t.id).then((function(t){e.$message.success("删除成功"),e.getList(),e.getTotal()}))})).catch((function(){e.$message.info("已取消删除")}))},handleTabClick:function(t){var e=t.name;"afterPullScript"===e?(this.$refs.afterPullScript.refresh(),this.handleScriptModeChange(this.formData.afterPullScriptMode)):"afterDeployScript"===e&&(this.$refs.afterDeployScript.refresh(),this.handleScriptModeChange(this.formData.afterDeployScriptMode))},handleScriptModeChange:function(t){this.cmOption.mode=""!==t?this.scriptModeOption.find((function(e){return e.value===t}))["mode"]:"text/x-sh"},handleServer:function(t){this.getBindServerList(t.id),this.addServerFormData.projectId=t.id,this.dialogServerVisible=!0},handleGroup:function(t){this.getBindServerList(t.id),this.addServerFormData.projectId=t.id,this.dialogServerVisible=!0},handleUser:function(t){this.getBindUserList(t.id),this.addUserFormData.projectId=t.id,this.dialogUserVisible=!0},handleAddServer:function(){this.dialogAddServerVisible=!0},handleAddUser:function(){this.dialogAddUserVisible=!0},submit:function(){var t=this;this.$refs.form.validate((function(e){if(!e)return!1;!1===t.formProps.symlink&&(t.formData.symlinkPath=""),0===t.formData.id?t.add():t.edit()}))},add:function(){var t=this;this.formProps.disabled=!0,Object(c["a"])(this.formData).then((function(e){t.dialogVisible=!1,t.$message.success("添加成功"),t.getList(),t.getTotal()})).finally((function(){t.formProps.disabled=!1}))},edit:function(){var t=this;this.formProps.disabled=!0,Object(c["e"])(this.formData).then((function(e){t.dialogVisible=!1,t.$message.success("修改成功"),t.getList()})).finally((function(){t.formProps.disabled=!1}))},addServer:function(){var t=this;this.$refs.addServerForm.validate((function(e){if(!e)return!1;t.addServerFormProps.disabled=!0,Object(c["b"])(t.addServerFormData).then((function(e){t.dialogAddServerVisible=!1,t.$message.success("添加成功"),t.getBindServerList(t.addServerFormData.projectId)})).finally((function(){t.addServerFormProps.disabled=!1}))}))},addUser:function(){var t=this;this.$refs.addUserForm.validate((function(e){if(!e)return!1;t.addUserFormProps.disabled=!0,Object(c["d"])(t.addUserFormData).then((function(e){t.dialogAddUserVisible=!1,t.$message.success("添加成功"),t.getBindUserList(t.addUserFormData.projectId)})).finally((function(){t.addUserFormProps.disabled=!1}))}))},removeProjectServer:function(t){var e=this;this.$confirm("此操作将永久删除该服务器的绑定关系, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(c["p"])(t.id).then((function(r){e.$message.success("删除成功"),e.getBindServerList(t.projectId)}))})).catch((function(){e.$message.info("已取消删除")}))},removeProjectUser:function(t){var e=this;this.$confirm("此操作将永久删除该用户的绑定关系, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(c["q"])(t.id).then((function(r){e.$message.success("删除成功"),e.getBindUserList(t.projectId)}))})).catch((function(){e.$message.info("已取消删除")}))},getOptions:function(){var t=this;Object(l["g"])().then((function(e){t.serverOption=e.data.list,t.serverOption.map((function(t){return t.label=t.name+(t.description.length>0?"("+t.description+")":""),t}))})),Object(i["d"])().then((function(e){t.userOption=e.data.list})),Object(s["e"])().then((function(e){t.groupOption=e.data.list}))},getList:function(){var t=this;Object(c["j"])(this.pagination,this.projectName).then((function(e){t.tableData=e.data.list})).catch((function(){}))},getTotal:function(){var t=this;Object(c["n"])(this.projectName).then((function(e){t.pagination.total=e.data.total}))},getBindServerList:function(t){var e=this;Object(c["h"])(t).then((function(t){e.tableServerData=t.data.list}))},getBindUserList:function(t){var e=this;Object(c["i"])(t).then((function(t){e.tableUserData=t.data.list}))},getRemoteBranchList:function(){var t=this;this.formProps.branch.length>0?this.$message.info("无需重复获取"):(this.formProps.lsBranchLoading=!0,Object(c["l"])(this.formData.url).then((function(e){t.formProps.branch=e.data.branch,t.$message.success("获取成功")})).finally((function(){t.formProps.lsBranchLoading=!1})))},searchProjectList:function(){this.pagination.page=1,this.getList(),this.getTotal()},handlePageChange:function(t){this.pagination.page=t,this.getList()},findGroupName:function(t){var e=this.groupOption.find((function(e){return e.id===t}));return e?e["name"]:"默认"},storeFormData:function(){this.tempFormData=JSON.parse(JSON.stringify(this.formData))},restoreFormData:function(){this.formData=JSON.parse(JSON.stringify(this.tempFormData))}}}),p=u,f=(r("d672"),r("b996"),r("4023")),m=Object(f["a"])(p,a,o,!1,null,"2b7249ab",null);e["default"]=m.exports},d672:function(t,e,r){"use strict";var a=r("8a92"),o=r.n(a);o.a},e828:function(t,e,r){}}]);